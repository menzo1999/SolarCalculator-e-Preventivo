<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solar Calculator – Bertuzzi Energy</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: #ffffff;
    color: #1a1a1a;
    line-height: 1.6;
    padding: 40px 20px;
    scroll-behavior: smooth;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
}

/* Header principale */
.main-header {
    text-align: center;
    margin-bottom: 50px;
    padding-bottom: 30px;
    border-bottom: 2px solid #f0f0f0;
}

.logo-title {
    font-size: 42px;
    font-weight: 700;
    color: #0a5f5f;
    margin-bottom: 12px;
    letter-spacing: -0.5px;
}

.subtitle {
    font-size: 18px;
    color: #666;
    font-weight: 400;
    max-width: 700px;
    margin: 0 auto;
}

/* Sezioni */
.section {
    padding: 50px 40px;
    margin-bottom: 30px;
    background: #ffffff;
    border-radius: 16px;
    border: 1px solid #e5e5e5;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
}

.section:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

/* Titoli sezioni */
h2 {
    color: #0a5f5f;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
}

.section-intro {
    text-align: center;
    font-size: 18px;
    color: #666;
    margin-bottom: 40px;
    line-height: 1.8;
}

/* Form */
.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    margin-top: 30px;
}

.form-field {
    display: flex;
    flex-direction: column;
}

label {
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

input, select {
    padding: 14px 16px;
    border: 2px solid #e5e5e5;
    border-radius: 8px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.3s ease;
    background: #fafafa;
}

input:focus, select:focus {
    outline: none;
    border-color: #0a5f5f;
    background: #ffffff;
    box-shadow: 0 0 0 3px rgba(10, 95, 95, 0.1);
}

input:hover, select:hover {
    border-color: #0a5f5f;
    background: #ffffff;
}

/* Help link */
.help-link {
    margin-top: 8px;
}

.help-link span {
    font-size: 13px;
    color: #0a5f5f;
    cursor: pointer;
    text-decoration: underline;
    font-weight: 500;
    transition: color 0.3s ease;
}

.help-link span:hover {
    color: #0d7a7a;
}

/* Pulsanti */
button {
    padding: 16px 32px;
    background: linear-gradient(135deg, #0a5f5f 0%, #0d7a7a 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(10, 95, 95, 0.2);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(10, 95, 95, 0.3);
}

button:active {
    transform: translateY(0);
}

.btn-full {
    width: 100%;
    grid-column: span 2;
    margin-top: 10px;
}

.btn-primary {
    background: linear-gradient(135deg, #0a5f5f 0%, #0d7a7a 100%);
}

.btn-secondary {
    background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
    margin-top: 15px;
}

/* Risultati */
.result-container {
    background: linear-gradient(135deg, #f8fffe 0%, #f0faf9 100%);
    padding: 35px;
    margin-top: 30px;
    border-radius: 12px;
    border-left: 4px solid #0a5f5f;
}

.result-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 0;
    border-bottom: 1px solid #e0e0e0;
}

.result-row:last-child {
    border-bottom: none;
}

.result-label {
    font-weight: 600;
    color: #333;
    font-size: 15px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.result-value {
    font-weight: 700;
    color: #0a5f5f;
    font-size: 22px;
}

.result-highlight {
    background: #ffffff;
    padding: 25px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: center;
    border: 2px solid #0a5f5f;
}

.result-highlight .label {
    font-size: 14px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
}

.result-highlight .value {
    font-size: 32px;
    font-weight: 700;
    color: #0a5f5f;
}

/* Responsive */
@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .btn-full {
        grid-column: span 1;
    }
    
    .section {
        padding: 30px 20px;
    }
    
    .logo-title {
        font-size: 32px;
    }
    
    h2 {
        font-size: 24px;
    }
}

/* Animazioni */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.section {
    animation: fadeIn 0.5s ease;
}
</style>
</head>
<body>

<div class="container">

<!-- HEADER -->
<div class="main-header">
    <h1 class="logo-title">Solar Calculator</h1>
    <p class="subtitle">Strumento professionale per la stima del tuo impianto fotovoltaico. Calcola potenza, costi e risparmio energetico.</p>
</div>

<!-- SEZIONE 1 -->
<div id="section1" class="section">
    <div class="section-intro">
        <p style="font-size: 20px; color: #333; margin-bottom: 30px;">
            <strong>Inizia la tua valutazione energetica</strong>
        </p>
        <p>
            Scopri la soluzione fotovoltaica ideale per la tua abitazione o azienda.<br>
            Analisi dettagliata di potenza consigliata, investimento richiesto e periodo di ammortamento.
        </p>
    </div>
    <button class="btn-primary btn-full" onclick="mostraSezione('section2')">
        Inizia il Calcolo
    </button>
</div>

<!-- SEZIONE 2 -->
<div id="section2" class="section" style="display:none;">
    <h2>Dati Tecnici</h2>
    <form id="solarForm" class="form-grid">
        <div class="form-field" style="grid-column: span 2;">
            <label>Tipologia Cliente</label>
            <select id="tipoCliente" required>
                <option value="privato">Privato</option>
                <option value="azienda">Azienda</option>
            </select>
        </div>
        <div class="form-field" style="grid-column: span 2;">
            <label>Area Geografica</label>
            <select id="area" required onchange="aggiornaRegioni()">
                <option value="">Seleziona area</option>
                <option value="nord">Nord Italia (1200 kWh/kW)</option>
                <option value="centro">Centro Italia (1300 kWh/kW)</option>
                <option value="sud">Sud Italia (1500 kWh/kW)</option>
                <option value="isole">Isole (1500 kWh/kW)</option>
            </select>
        </div>
        <div class="form-field" style="grid-column: span 2;">
            <label>Regione</label>
            <select id="regione" required>
                <option value="">Seleziona prima l'area geografica</option>
            </select>
        </div>
        <div class="form-field" style="grid-column: span 2;">
            <label>Tipo di Fornitura</label>
            <select id="tipoFornitura" required>
                <option value="monofase">Monofase (230V)</option>
                <option value="trifase">Trifase (400V)</option>
            </select>
        </div>
        <div class="form-field" id="campoConsumo">
            <label>Consumo Annuo (kWh)</label>
            <input type="number" id="consumo" placeholder="es. 3500">
            <div class="help-link" onclick="toggleStima()">
                <span style="font-size: 13px; color: #0a5f5f; cursor: pointer; text-decoration: underline;">
                    Non conosci esattamente il tuo consumo? Fai una stima
                </span>
            </div>
            <div id="stimaConsumo" style="display: none; margin-top: 10px;">
                <select id="stimaSelect" onchange="applicaStima()" style="font-size: 14px;">
                    <option value="">Seleziona in base alle persone</option>
                    <option value="2300">1 persona (≈ 2.300 kWh/anno)</option>
                    <option value="3400">2 persone (≈ 3.400 kWh/anno)</option>
                    <option value="4100">3 persone (≈ 4.100 kWh/anno)</option>
                    <option value="4600">4 persone (≈ 4.600 kWh/anno)</option>
                    <option value="5300">5 persone (≈ 5.300 kWh/anno)</option>
                </select>
            </div>
        </div>
        <div class="form-field">
            <label>Superficie Disponibile (m²)</label>
            <input type="number" id="superficie" placeholder="es. 50" required>
            <div class="help-link" onclick="toggleCampo()">
                <span style="font-size: 13px; color: #0a5f5f; cursor: pointer; text-decoration: underline;">
                    Vuoi installare l'impianto in un campo?
                </span>
            </div>
            <div id="opzioneCampo" style="display: none; margin-top: 10px;">
                <select id="installazioneCampo" onchange="gestioneCampo()" style="font-size: 14px;">
                    <option value="no">No, installazione su tetto</option>
                    <option value="si">Sì, installazione su campo</option>
                </select>
            </div>
        </div>
        <div class="form-field" id="campoPiccoConsumo">
            <label>Picco Consumo</label>
            <select id="consumoPico">
                <option value="giorno">Prevalentemente diurno</option>
                <option value="notte">Prevalentemente serale/notturno</option>
            </select>
        </div>
        <div class="form-field" id="campoTipoTetto">
            <label>Tipologia Tetto</label>
            <select id="tipoTetto">
                <option value="inclinato">Inclinato</option>
                <option value="piatto">Piatto</option>
            </select>
        </div>
        <div class="form-field" id="campoEsposizione">
            <label>Esposizione Tetto</label>
            <select id="esposizione">
                <option value="sud">Sud (Ottimale)</option>
                <option value="est">Est</option>
                <option value="ovest">Ovest</option>
                <option value="nord">Nord</option>
            </select>
        </div>
        <div class="form-field" id="campoMaterialeTetto">
            <label>Materiale Tetto</label>
            <select id="materialeTetto">
                <option value="tegole">Tegole</option>
                <option value="lamiere">Lamiere metalliche</option>
                <option value="cemento">Cemento</option>
                <option value="altro">Altro</option>
            </select>
        </div>
        <button type="button" class="btn-primary btn-full" onclick="calcola()">
            Calcola Impianto
        </button>
    </form>
</div>

<!-- SEZIONE 3 -->
<div id="section3" class="section" style="display:none;">
    <h2>Risultati Simulazione</h2>
    <div id="result" class="result-container">
        <div id="risultatoTesto"></div>
    </div>
    <button class="btn-primary btn-full" onclick="scaricaPreventivo()">
        Scarica Preventivo PDF
    </button>
</div>

</div>

<script>
// Definizione regioni per area
const regioniPerArea = {
    nord: [
        'Emilia-Romagna',
        'Lombardia',
        'Veneto',
        'Piemonte',
        'Liguria',
        'Trentino-Alto Adige',
        'Friuli-Venezia Giulia',
        'Valle d\'Aosta'
    ],
    centro: [
        'Toscana',
        'Marche',
        'Umbria',
        'Lazio'
    ],
    sud: [
        'Abruzzo',
        'Molise',
        'Campania',
        'Puglia',
        'Basilicata',
        'Calabria'
    ],
    isole: [
        'Sicilia',
        'Sardegna'
    ]
};

// Surplus di trasferta per regione
const surplusTrasferta = {
    'Emilia-Romagna': 0,
    'Toscana': 5,
    'Marche': 5,
    'Veneto': 5,
    'Lombardia': 5,
    'Liguria': 8,
    'Piemonte': 8,
    'Trentino-Alto Adige': 8,
    'Umbria': 8,
    'Lazio': 8,
    'Abruzzo': 10,
    'Molise': 10,
    'Campania': 10,
    'Puglia': 10,
    'Basilicata': 10,
    'Calabria': 10,
    'Sicilia': 10,
    'Sardegna': 10,
    'Friuli-Venezia Giulia': 10,
    'Valle d\'Aosta': 10
};

function aggiornaRegioni() {
    const area = document.getElementById('area').value;
    const regioneSelect = document.getElementById('regione');
    
    regioneSelect.innerHTML = '<option value="">Seleziona regione</option>';
    
    if (area && regioniPerArea[area]) {
        regioniPerArea[area].forEach(regione => {
            const option = document.createElement('option');
            option.value = regione;
            option.textContent = regione;
            regioneSelect.appendChild(option);
        });
    }
}

function mostraSezione(id) {
    document.getElementById(id).style.display = 'block';
    document.getElementById(id).scrollIntoView({behavior: "smooth"});
}

function toggleStima() {
    const stimaDiv = document.getElementById('stimaConsumo');
    if (stimaDiv.style.display === 'none') {
        stimaDiv.style.display = 'block';
    } else {
        stimaDiv.style.display = 'none';
    }
}

function toggleCampo() {
    const campoDiv = document.getElementById('opzioneCampo');
    if (campoDiv.style.display === 'none') {
        campoDiv.style.display = 'block';
    } else {
        campoDiv.style.display = 'none';
    }
}

function gestioneCampo() {
    const installazioneCampo = document.getElementById('installazioneCampo').value;
    const campiTetto = ['campoTipoTetto', 'campoEsposizione', 'campoMaterialeTetto'];
    const campiConsumo = ['campoConsumo', 'campoPiccoConsumo'];
    
    if (installazioneCampo === 'si') {
        // Nascondi i campi relativi al tetto e al consumo
        campiTetto.forEach(campo => {
            document.getElementById(campo).style.display = 'none';
        });
        campiConsumo.forEach(campo => {
            document.getElementById(campo).style.display = 'none';
        });
        // Imposta valori ottimali per il campo
        document.getElementById('tipoTetto').value = 'inclinato';
        document.getElementById('esposizione').value = 'sud';
        document.getElementById('consumo').removeAttribute('required');
    } else {
        // Mostra tutti i campi
        campiTetto.forEach(campo => {
            document.getElementById(campo).style.display = 'flex';
        });
        campiConsumo.forEach(campo => {
            document.getElementById(campo).style.display = 'flex';
        });
        document.getElementById('consumo').setAttribute('required', 'required');
    }
}

function applicaStima() {
    const stimaValue = document.getElementById('stimaSelect').value;
    if (stimaValue) {
        document.getElementById('consumo').value = stimaValue;
    }
}

function calcola() {
    mostraSezione('section3');

    const area = document.getElementById("area").value;
    const regione = document.getElementById("regione").value;
    const tipoFornitura = document.getElementById("tipoFornitura").value;
    const consumoInput = document.getElementById("consumo").value;
    const consumo = consumoInput ? parseFloat(consumoInput) : null;
    const superficie = parseFloat(document.getElementById("superficie").value);
    const consumoPico = document.getElementById("consumoPico").value;
    const installazioneCampo = document.getElementById("installazioneCampo").value;
    const tipoTetto = document.getElementById("tipoTetto").value;
    const esposizione = document.getElementById("esposizione").value;

    let kWhPerKW;
    if (area === "nord") kWhPerKW = 1200;
    else if (area === "centro") kWhPerKW = 1300;
    else kWhPerKW = 1500;

    let fattoreEsposizione = 1.0;
    
    if (esposizione === "sud") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 1.0 : 0.95;
    } else if (esposizione === "est" || esposizione === "ovest") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 0.82 : 0.78;
    } else if (esposizione === "nord") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 0.65 : 0.70;
    }

    kWhPerKW = kWhPerKW * fattoreEsposizione;

    const m2PerKW = 7;
    const costoKW = 1500;
    const costoBatteria = 3000;
    const prezzoEnergia = 0.25;

    let kWInstallabili, produzioneAnnua, numBatterie = 0;
    let isCampoVendita = installazioneCampo === "si" || !consumo;

    if (isCampoVendita) {
        // Calcolo basato solo sulla superficie per vendita energia
        kWInstallabili = superficie / m2PerKW;
        produzioneAnnua = kWInstallabili * kWhPerKW;
        numBatterie = 0; // Nessuna batteria per vendita energia
    } else {
        // Calcolo normale con consumo
        let kWRichiesti = consumo / kWhPerKW;
        let kWMassimi = superficie / m2PerKW;
        kWInstallabili = Math.min(kWRichiesti, kWMassimi);
        produzioneAnnua = kWInstallabili * kWhPerKW;
        
        let consumoGiornaliero = consumo / 365;
        let shareNight = consumoPico === "notte" ? 0.7 : 0.3;
        let consumoNotte = consumoGiornaliero * shareNight;
        let capacitaBatteria = consumoNotte * 0.8;
        numBatterie = consumoPico === "notte" ? Math.ceil(capacitaBatteria / 5) : 0;
    }

    let costoPannelli = kWInstallabili * costoKW;
    let costoBatterie = numBatterie * costoBatteria;
    let costoBase = costoPannelli + costoBatterie;
    
    // Calcolo surplus trasferta
    let percentualeSurplus = surplusTrasferta[regione] || 0;
    let costoTrasferta = costoBase * (percentualeSurplus / 100);
    let costoTotale = costoBase + costoTrasferta;

    let ricavoAnnuale = produzioneAnnua * prezzoEnergia;
    let ammortamento = costoTotale / ricavoAnnuale;

    const areaLabel = area === "nord" ? "Nord Italia" : area === "centro" ? "Centro Italia" : area === "sud" ? "Sud Italia" : "Isole";
    const esposizioneLabel = esposizione.charAt(0).toUpperCase() + esposizione.slice(1);
    const tipoTettoLabel = tipoTetto === "inclinato" ? "Inclinato" : "Piatto";
    const efficienzaPerc = (fattoreEsposizione * 100).toFixed(0);
    const tipoInstallazione = installazioneCampo === "si" ? "Campo (Vendita Energia)" : "Tetto";

    let risultatoHTML = `
        <div class="result-row">
            <span class="result-label">Tipo Installazione</span>
            <span class="result-value">${tipoInstallazione}</span>
        </div>
        <div class="result-row">
            <span class="result-label">Area Geografica</span>
            <span class="result-value">${areaLabel}</span>
        </div>
        <div class="result-row">
            <span class="result-label">Regione</span>
            <span class="result-value">${regione}</span>
        </div>`;
    
    if (installazioneCampo === "no" && consumo) {
        risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Esposizione / Tetto</span>
            <span class="result-value">${esposizioneLabel} / ${tipoTettoLabel} (${efficienzaPerc}%)</span>
        </div>`;
    } else {
        risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Configurazione</span>
            <span class="result-value">Ottimale (100%)</span>
        </div>`;
    }
    
    risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Potenza Installata</span>
            <span class="result-value">${kWInstallabili.toFixed(2)} kW</span>
        </div>
        <div class="result-row">
            <span class="result-label">Produzione Annua</span>
            <span class="result-value">${produzioneAnnua.toFixed(0)} kWh</span>
        </div>`;
    
    if (!isCampoVendita) {
        risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Batterie Consigliate</span>
            <span class="result-value">${numBatterie} unità</span>
        </div>`;
    }
    
    risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Investimento Base</span>
            <span class="result-value">€ ${costoBase.toLocaleString('it-IT', {minimumFractionDigits: 2})}</span>
        </div>`;
    
    if (percentualeSurplus > 0) {
        risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Surplus Trasferta (${percentualeSurplus}%)</span>
            <span class="result-value">€ ${costoTrasferta.toLocaleString('it-IT', {minimumFractionDigits: 2})}</span>
        </div>`;
    }
    
    risultatoHTML += `
        <div class="result-row">
            <span class="result-label">Investimento Totale</span>
            <span class="result-value">€ ${costoTotale.toLocaleString('it-IT', {minimumFractionDigits: 2})}</span>
        </div>
        <div class="result-row">
            <span class="result-label">${isCampoVendita ? 'Ricavo Annuale Stimato' : 'Risparmio Annuale'}</span>
            <span class="result-value">€ ${ricavoAnnuale.toLocaleString('it-IT', {minimumFractionDigits: 2})}</span>
        </div>
        <div class="result-highlight">
            <div class="label">Periodo di Ammortamento</div>
            <div class="value">${ammortamento.toFixed(1)} anni</div>
        </div>
    `;
    
    document.getElementById("risultatoTesto").innerHTML = risultatoHTML;
}

function scaricaPreventivo() {
    const tipoCliente = document.getElementById("tipoCliente").value;
    const area = document.getElementById("area").value;
    const regione = document.getElementById("regione").value;
    const tipoFornitura = document.getElementById("tipoFornitura").value;
    const consumoInput = document.getElementById("consumo").value;
    const consumo = consumoInput ? parseFloat(consumoInput) : null;
    const superficie = parseFloat(document.getElementById("superficie").value);
    const consumoPico = document.getElementById("consumoPico").value;
    const installazioneCampo = document.getElementById("installazioneCampo").value;
    const tipoTetto = document.getElementById("tipoTetto").value;
    const esposizione = document.getElementById("esposizione").value;
    const materialeTetto = document.getElementById("materialeTetto").value;

    let kWhPerKW;
    if (area === "nord") kWhPerKW = 1200;
    else if (area === "centro") kWhPerKW = 1300;
    else kWhPerKW = 1500;

    let fattoreEsposizione = 1.0;
    if (esposizione === "sud") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 1.0 : 0.95;
    } else if (esposizione === "est" || esposizione === "ovest") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 0.82 : 0.78;
    } else if (esposizione === "nord") {
        fattoreEsposizione = tipoTetto === "inclinato" ? 0.65 : 0.70;
    }

    kWhPerKW = kWhPerKW * fattoreEsposizione;

    const m2PerKW = 7;
    const costoKW = 1500;
    const costoBatteria = 3000;
    const prezzoEnergia = 0.25;
    const potenzaPannello = 0.45;

    let kWInstallabili, produzioneAnnua, numBatterie = 0;
    let isCampoVendita = installazioneCampo === "si" || !consumo;

    if (isCampoVendita) {
        // Calcolo basato solo sulla superficie per vendita energia
        kWInstallabili = superficie / m2PerKW;
        produzioneAnnua = kWInstallabili * kWhPerKW;
        numBatterie = 0;
    } else {
        // Calcolo normale con consumo
        let kWRichiesti = consumo / kWhPerKW;
        let kWMassimi = superficie / m2PerKW;
        kWInstallabili = Math.min(kWRichiesti, kWMassimi);
        produzioneAnnua = kWInstallabili * kWhPerKW;
        
        let consumoGiornaliero = consumo / 365;
        let shareNight = consumoPico === "notte" ? 0.7 : 0.3;
        let consumoNotte = consumoGiornaliero * shareNight;
        let capacitaBatteria = consumoNotte * 0.8;
        numBatterie = consumoPico === "notte" ? Math.ceil(capacitaBatteria / 5) : 0;
    }
    
    let costoPannelli = kWInstallabili * costoKW;
    let costoBatterie = numBatterie * costoBatteria;
    let costoBase = costoPannelli + costoBatterie;
    
    // Calcolo surplus trasferta
    let percentualeSurplus = surplusTrasferta[regione] || 0;
    let costoTrasferta = costoBase * (percentualeSurplus / 100);
    let costoTotale = costoBase + costoTrasferta;
    
    let ricavoAnnuale = produzioneAnnua * prezzoEnergia;
    let ammortamento = costoTotale / ricavoAnnuale;

    let numPannelli = Math.ceil(kWInstallabili / potenzaPannello);

    // Selezione inverter in base a potenza, tipo fornitura e presenza batterie
    let inverter = "";
    let tipoInverter = "";
    let specificheTecniche = {};
    
    if (numBatterie > 0) {
        // Con accumulo: Inverter Ibrido
        if (tipoFornitura === "monofase") {
            // Inverter Monofase con Accumulo
            tipoInverter = "Ibrido Monofase con Accumulo";
            if (kWInstallabili <= 4.5) {
                inverter = "HYD 3000-ZSS";
                specificheTecniche = {
                    gamma: "3 kW",
                    tipo: "Inverter ibrido monofase per impianti con accumulo integrato",
                    compatibilita: "Batterie al litio ZCS e altri modelli compatibili",
                    funzione: "Gestione simultanea di produzione fotovoltaica, accumulo e rete",
                    efficienza: "Fino al 97,6%",
                    tensioneMPPT: "180 – 550 Vdc",
                    mppt: "2 MPPT indipendenti",
                    tensione: "230 Vac (monofase)",
                    protezione: "Anti-islanding, sovratensione, inversione polarità, cortocircuito",
                    comunicazione: "Wi-Fi / Ethernet / RS485",
                    grado: "IP65",
                    rumorosita: "< 25 dB"
                };
            } else {
                inverter = "HYD 6000-ZSS";
                specificheTecniche = {
                    gamma: "6 kW",
                    tipo: "Inverter ibrido monofase per impianti con accumulo integrato",
                    compatibilita: "Batterie al litio ZCS e altri modelli compatibili",
                    funzione: "Gestione simultanea di produzione fotovoltaica, accumulo e rete",
                    efficienza: "Fino al 97,6%",
                    tensioneMPPT: "180 – 550 Vdc",
                    mppt: "2 MPPT indipendenti",
                    tensione: "230 Vac (monofase)",
                    protezione: "Anti-islanding, sovratensione, inversione polarità, cortocircuito",
                    comunicazione: "Wi-Fi / Ethernet / RS485",
                    grado: "IP65",
                    rumorosita: "< 25 dB"
                };
            }
        } else {
            // Inverter Trifase con Accumulo
            tipoInverter = "Ibrido Trifase con Accumulo";
            if (kWInstallabili <= 6.5) {
                inverter = "HYD 5000 ZSS";
            } else if (kWInstallabili <= 9) {
                inverter = "HYD 8000 ZSS";
            } else if (kWInstallabili <= 12.5) {
                inverter = "HYD 10000 ZSS";
            } else if (kWInstallabili <= 17.5) {
                inverter = "HYD 15000 ZSS";
            } else {
                inverter = "HYD 20000 ZSS";
            }
            specificheTecniche = {
                gamma: "5 - 20 kW",
                tipo: "Inverter ibrido trifase per impianti con accumulo integrato",
                compatibilita: "Batterie al litio ZCS e altri modelli compatibili",
                funzione: "Gestione simultanea di produzione fotovoltaica, accumulo e rete",
                efficienza: "Fino al 97,6%",
                tensioneMPPT: "180 – 850 Vdc",
                mppt: "2 MPPT indipendenti",
                tensione: "400 Vac (trifase)",
                protezione: "Anti-islanding, sovratensione, inversione polarità, cortocircuito",
                comunicazione: "Wi-Fi / Ethernet / RS485",
                grado: "IP65",
                rumorosita: "< 25 dB"
            };
        }
    } else {
        // Senza accumulo
        if (tipoFornitura === "monofase" && kWInstallabili <= 6) {
            // Inverter Monofase (1-6 kW)
            tipoInverter = "Monofase";
            if (kWInstallabili <= 2.2) {
                inverter = "TL-V3 1,1 kW";
            } else if (kWInstallabili <= 3) {
                inverter = "TL-V3 3 kW";
            } else if (kWInstallabili <= 3.3) {
                inverter = "TL-V3 3,3 kW";
            } else if (kWInstallabili <= 4.5) {
                inverter = "TLM-V3 3 kW";
            } else if (kWInstallabili <= 5) {
                inverter = "TLM-V3 5 kW";
            } else {
                inverter = "TLM-V3 6 kW";
            }
            specificheTecniche = {
                gamma: "1,1 - 6 kW",
                tipo: "Inverter fotovoltaico monofase connesso alla rete (senza accumulo)",
                funzione: "Conversione energia prodotta dai moduli in energia utilizzabile in rete",
                efficienza: "Fino al 97,8%",
                tensioneMPPT: "100 – 550 Vdc",
                mppt: "2 MPPT indipendenti",
                tensione: "230 Vac (monofase)",
                protezione: "Anti-islanding, sovratensione AC/DC, inversione polarità, cortocircuito",
                comunicazione: "Wi-Fi / RS485",
                grado: "IP65",
                rumorosita: "< 25 dB"
            };
        } else {
            // Inverter Trifase (3,3-350 kW)
            tipoInverter = "Trifase";
            if (kWInstallabili <= 7.5) {
                inverter = "3PH 3.3KTL-V1";
            } else if (kWInstallabili <= 11) {
                inverter = "3PH 10KTL-V2";
            } else if (kWInstallabili <= 13.5) {
                inverter = "3PH 12KTL-V1";
            } else if (kWInstallabili <= 17.5) {
                inverter = "3PH 15KTL-V2";
            } else if (kWInstallabili <= 22.5) {
                inverter = "3PH 20KTL-V2";
            } else if (kWInstallabili <= 27.5) {
                inverter = "3PH 25KTL-V3";
            } else if (kWInstallabili <= 31.5) {
                inverter = "3PH 30KTL-V3";
            } else if (kWInstallabili <= 34.5) {
                inverter = "3PH 33KTL-V2";
            } else if (kWInstallabili <= 38) {
                inverter = "3PH 36KTL-V3";
            } else if (kWInstallabili <= 42.5) {
                inverter = "3PH 40KTL-V3";
            } else if (kWInstallabili <= 47.5) {
                inverter = "3PH 45KTL-V3";
            } else if (kWInstallabili <= 55) {
                inverter = "3PH 50KTL-V3";
            } else if (kWInstallabili <= 70) {
                inverter = "3PH 60KTL-V3";
            } else if (kWInstallabili <= 90) {
                inverter = "3PH 80KTL-V3";
            } else if (kWInstallabili <= 105) {
                inverter = "3PH 100KTL-V4";
            } else if (kWInstallabili <= 180) {
                inverter = "3PH 110KTL-V4";
            } else if (kWInstallabili <= 290) {
                inverter = "3PH 250KTL-HV Z0";
            } else if (kWInstallabili <= 340) {
                inverter = "3PH 330KTL-HV Z0";
            } else {
                inverter = "3PH 350KTL-HV Z0";
            }
            specificheTecniche = {
                gamma: "3,3 - 350 kW",
                tipo: "Inverter fotovoltaico trifase connesso alla rete (senza accumulo)",
                funzione: "Conversione energia prodotta dai moduli in energia trifase per autoconsumo o immissione in rete",
                efficienza: "Fino al 98,6%",
                tensioneMPPT: "180 – 1000 Vdc",
                mppt: "2 o più MPPT indipendenti",
                tensione: "400 Vac (trifase)",
                protezione: "Anti-islanding, sovratensione AC/DC, inversione polarità, cortocircuito",
                comunicazione: "Wi-Fi / RS485 / Ethernet",
                grado: "IP65",
                rumorosita: "< 30 dB"
            };
        }
    }

    // Definisci isCampoVendita per uso nel template
    let isCampoVenditaPDF = isCampoVendita;

    const areaLabel = area === "nord" ? "Nord Italia" : area === "centro" ? "Centro Italia" : area === "sud" ? "Sud Italia" : "Isole";
    const esposizioneLabel = esposizione.charAt(0).toUpperCase() + esposizione.slice(1);
    const tipoTettoLabel = tipoTetto === "inclinato" ? "Inclinato" : "Piatto";
    const tipoClienteLabel = tipoCliente === "privato" ? "Privato" : "Azienda";
    const tipoInstallazione = installazioneCampo === "si" ? "Campo" : "Tetto";
    const dataOggi = new Date().toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });

    // Sezione pagamenti specifica per tipo cliente
    let sezionePagamenti = '';
    if (tipoCliente === "privato") {
        sezionePagamenti = `
    <h2 class="section-title">MODALITÀ DI PAGAMENTO</h2>
    
    <div class="info-box" style="background: #f0f9f4; border-left: 4px solid #0a5f5f;">
        <strong style="font-size: 16px; color: #0a5f5f;">PAGAMENTI:</strong><br><br>
        <strong>► 30% ACCONTO + SALDO FINE LAVORI</strong><br><br>
        <strong>► ALTERNATIVA: Pagamento a Rate con Findomestic</strong>
    </div>

    <div style="margin: 25px 0; padding: 20px; background: white; border: 2px solid #0a5f5f; border-radius: 8px;">
        <h3 style="color: #0a5f5f; margin-bottom: 15px; font-size: 18px;">Impianti per Privati: Sicurezza ed Energia con Pagamento Flessibile</h3>
        <p style="margin-bottom: 15px; line-height: 1.8;">
            Grazie alla nostra partnership con <strong>Findomestic</strong>, anche i privati possono accedere facilmente ai nostri impianti di fotovoltaico, allarme e videosorveglianza, senza dover sostenere l'intero investimento iniziale. È possibile rateizzare l'acquisto tramite un prestito dedicato, con condizioni chiare e vantaggiose, così da distribuire il costo nel tempo senza rinunciare alla qualità e all'efficienza dei sistemi.
        </p>
        <div style="background: #f8fffe; padding: 15px; border-radius: 6px; margin-top: 15px;">
            <p style="font-style: italic; color: #0a5f5f; font-size: 16px; font-weight: 600; text-align: center;">
                "Sicurezza ed energia alla portata di tutti"
            </p>
        </div>
        <p style="margin-top: 15px; line-height: 1.8;">
            Grazie a queste soluzioni, ogni famiglia può proteggere la propria abitazione, monitorare la sicurezza e produrre energia pulita, con la massima comodità e flessibilità, valorizzando l'immobile e riducendo le spese fin da subito.
        </p>
    </div>
        `;
    } else {
        sezionePagamenti = `
    <h2 class="section-title">MODALITÀ DI PAGAMENTO</h2>
    
    <div class="info-box" style="background: #f0f9f4; border-left: 4px solid #0a5f5f;">
        <strong style="font-size: 16px; color: #0a5f5f;">PAGAMENTI:</strong><br><br>
        <strong>► 30% ACCONTO + SALDO FINE LAVORI</strong><br><br>
        <strong>► ALTERNATIVA: Noleggio Operativo con Grenke</strong>
    </div>

    <div style="margin: 25px 0; padding: 20px; background: white; border: 2px solid #0a5f5f; border-radius: 8px;">
        <h3 style="color: #0a5f5f; margin-bottom: 15px; font-size: 18px;">Noleggio Impianti per Aziende</h3>
        <p style="margin-bottom: 15px; line-height: 1.8;">
            Grazie alla collaborazione con <strong>Grenke</strong>, le aziende hanno la possibilità di noleggiare i nostri impianti di fotovoltaico, allarme e videosorveglianza, evitando l'investimento iniziale e gestendo i costi in modo semplice e flessibile. Questa soluzione permette di avere subito a disposizione impianti completi e altamente efficienti, personalizzati sulle esigenze dell'attività, pagando un canone mensile fisso senza incidere sul capitale aziendale.
        </p>
        <p style="margin-bottom: 15px; line-height: 1.8;">
            Il noleggio è pensato esclusivamente per aziende, studi professionali e attività commerciali, offrendo un modo conveniente per aumentare la sicurezza, migliorare l'efficienza energetica e tutelare il proprio business senza vincoli finanziari immediati.
        </p>
        <div style="background: #f8fffe; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <p style="font-style: italic; color: #0a5f5f; font-size: 16px; font-weight: 600; text-align: center;">
                "Un grande vantaggio"
            </p>
        </div>
        <p style="line-height: 1.8;">
            Al termine del periodo di noleggio, l'azienda può scegliere se restituire l'impianto nel caso non ne abbia più bisogno, oppure conservarlo definitivamente, diventandone proprietaria. In questo modo si uniscono flessibilità, sicurezza e risparmio, permettendo di investire subito in tecnologia avanzata senza impegnare il capitale e con la libertà di decidere in base alle proprie esigenze.
        </p>
    </div>
        `;
    }

    // Tabella costi con surplus
    let tabellaTrasferta = '';
    if (percentualeSurplus > 0) {
        tabellaTrasferta = `
        <tr>
            <td>Surplus Trasferta (${percentualeSurplus}%)</td>
            <td>€ ${costoTrasferta.toLocaleString('it-IT', {minimumFractionDigits: 2})}</td>
        </tr>`;
    }

    const preventivoHTML = `
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Preventivo Impianto Fotovoltaico - Bertuzzi Energy</title>
    <style>
        @media print {
            body { margin: 0; }
            .no-print { display: none; }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 210mm;
            margin: 20px auto;
            padding: 20mm;
            background: white;
            color: #1a1a1a;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #0a5f5f;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .logo {
            font-size: 32px;
            font-weight: 700;
            color: #0a5f5f;
            margin-bottom: 5px;
        }
        .subtitle {
            font-size: 14px;
            color: #666;
        }
        .info-box {
            background: #f8fffe;
            padding: 15px;
            border-left: 4px solid #0a5f5f;
            margin: 20px 0;
        }
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #0a5f5f;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f5f5f5;
            font-weight: 700;
            color: #0a5f5f;
        }
        .highlight {
            background: #0a5f5f;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin: 20px 0;
        }
        .highlight .value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
        }
        .highlight .label {
            font-size: 14px;
            opacity: 0.9;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        .btn-print {
            background: #0a5f5f;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px auto;
            display: block;
        }
        .btn-print:hover {
            background: #0d7a7a;
        }
    </style>
</head>
<body>
    <button class="btn-print no-print" onclick="window.print()">Stampa / Salva come PDF</button>

    <div class="header">
        <div class="logo">BERTUZZI ENERGY</div>
        <div class="subtitle">Soluzioni Fotovoltaiche Professionali</div>
    </div>

    <div class="info-box">
        <strong>PREVENTIVO N.</strong> PREV-${Date.now()}<br>
        <strong>Data:</strong> ${dataOggi}<br>
        <strong>Validità:</strong> 30 giorni<br>
        <strong>Tipologia Cliente:</strong> ${tipoClienteLabel}
    </div>

    <h2 class="section-title">RIEPILOGO CONFIGURAZIONE CLIENTE</h2>
    <table>
        <tr>
            <th>Parametro</th>
            <th>Valore</th>
        </tr>
        <tr>
            <td>Tipologia Cliente</td>
            <td>${tipoClienteLabel}</td>
        </tr>
        <tr>
            <td>Tipo Installazione</td>
            <td>${tipoInstallazione}</td>
        </tr>
        <tr>
            <td>Area Geografica</td>
            <td>${areaLabel}</td>
        </tr>
        <tr>
            <td>Regione</td>
            <td>${regione}</td>
        </tr>
        ${consumo ? `
        <tr>
            <td>Consumo Annuo Stimato</td>
            <td>${consumo.toLocaleString('it-IT')} kWh/anno</td>
        </tr>
        ` : ''}
        <tr>
            <td>Superficie Disponibile</td>
            <td>${superficie} m²</td>
        </tr>
        ${installazioneCampo === "no" ? `
        <tr>
            <td>Tipologia Tetto</td>
            <td>${tipoTettoLabel}</td>
        </tr>
        <tr>
            <td>Esposizione</td>
            <td>${esposizioneLabel}</td>
        </tr>
        <tr>
            <td>Materiale Copertura</td>
            <td>${materialeTetto.charAt(0).toUpperCase() + materialeTetto.slice(1)}</td>
        </tr>
        ` : `
        <tr>
            <td>Configurazione</td>
            <td>Struttura con angolazione ottimale per massima produzione</td>
        </tr>
        `}
        ${consumo && !isCampoVenditaPDF ? `
        <tr>
            <td>Picco di Consumo</td>
            <td>${consumoPico === "notte" ? "Serale/Notturno" : "Diurno"}</td>
        </tr>
        ` : ''}
    </table>

    <h2 class="section-title">SOLUZIONE PROPOSTA</h2>
    
    <div class="highlight">
        <div class="label">POTENZA IMPIANTO FOTOVOLTAICO</div>
        <div class="value">${kWInstallabili.toFixed(2)} kW</div>
        <div class="label">Produzione Annua Stimata: ${produzioneAnnua.toFixed(0)} kWh</div>
        ${isCampoVenditaPDF ? '<div class="label" style="margin-top: 10px; font-weight: 600;">Impianto per Vendita Energia alla Rete</div>' : ''}
    </div>

    <h2 class="section-title">MODULI FOTOVOLTAICI</h2>
    <table>
        <tr>
            <th>Caratteristica</th>
            <th>Specifica</th>
        </tr>
        <tr>
            <td><strong>Quantità</strong></td>
            <td><strong>${numPannelli} moduli</strong></td>
        </tr>
        <tr>
            <td>Tipologia</td>
            <td>Modulo Monocristallino</td>
        </tr>
        <tr>
            <td>Tecnologia</td>
            <td>Celle N-type i-TOPCon</td>
        </tr>
        <tr>
            <td>Configurazione</td>
            <td>144 Celle Perc®</td>
        </tr>
        <tr>
            <td>Potenza Modulo</td>
            <td>450 W</td>
        </tr>
        <tr>
            <td>Tensione MPP (Vmpp)</td>
            <td>44,60 Vdc</td>
        </tr>
        <tr>
            <td>Tensione Circuito Aperto (Voc)</td>
            <td>52,90 Vdc</td>
        </tr>
        <tr>
            <td>Corrente MPP (Impp)</td>
            <td>10,09 A</td>
        </tr>
        <tr>
            <td>Corrente Cortocircuito (Isc)</td>
            <td>10,74 A</td>
        </tr>
        <tr>
            <td>NOCT</td>
            <td>43 ± 2 °C</td>
        </tr>
        <tr>
            <td>Dimensioni</td>
            <td>1.762 × 1.134 × 30 mm</td>
        </tr>
        <tr>
            <td>Peso</td>
            <td>21 kg</td>
        </tr>
    </table>

    <h2 class="section-title">INVERTER</h2>
    <table>
        <tr>
            <th>Caratteristica</th>
            <th>Specifica</th>
        </tr>
        <tr>
            <td><strong>Modello Inverter</strong></td>
            <td><strong>${inverter}</strong></td>
        </tr>
        <tr>
            <td>Tipologia</td>
            <td>${specificheTecniche.tipo}</td>
        </tr>
        ${numBatterie > 0 ? `
        <tr>
            <td>Compatibilità batterie</td>
            <td>${specificheTecniche.compatibilita}</td>
        </tr>
        ` : ''}
        <tr>
            <td>Funzione principale</td>
            <td>${specificheTecniche.funzione}</td>
        </tr>
        <tr>
            <td>Efficienza massima</td>
            <td>${specificheTecniche.efficienza}</td>
        </tr>
        <tr>
            <td>Tensione MPPT</td>
            <td>${specificheTecniche.tensioneMPPT}</td>
        </tr>
        <tr>
            <td>Numero di MPPT</td>
            <td>${specificheTecniche.mppt}</td>
        </tr>
        <tr>
            <td>Tensione di rete</td>
            <td>${specificheTecniche.tensione}</td>
        </tr>
        <tr>
            <td>Protezione</td>
            <td>${specificheTecniche.protezione}</td>
        </tr>
        <tr>
            <td>Comunicazione</td>
            <td>${specificheTecniche.comunicazione} - Monitoraggio tramite ZCS Azzurro Cloud</td>
        </tr>
        <tr>
            <td>Grado di protezione</td>
            <td>${specificheTecniche.grado} - Adatto per installazione interna o esterna</td>
        </tr>
        <tr>
            <td>Rumorosità</td>
            <td>${specificheTecniche.rumorosita}</td>
        </tr>
    </table>

    ${numBatterie > 0 && !isCampoVenditaPDF ? `
    <h2 class="section-title">SISTEMA DI ACCUMULO</h2>
    <table>
        <tr>
            <th>Componente</th>
            <th>Specifica</th>
        </tr>
        <tr>
            <td><strong>Batterie di Accumulo</strong></td>
            <td><strong>${numBatterie} × Azzurro ZCS (5 kWh)</strong></td>
        </tr>
        <tr>
            <td>Capacità Totale Sistema</td>
            <td>${numBatterie * 5} kWh</td>
        </tr>
        <tr>
            <td colspan="2" style="font-size: 13px; color: #666;">
                Sistema di accumulo agli ioni di litio ad alte prestazioni per massimizzare 
                l'autoconsumo e l'indipendenza energetica.
            </td>
        </tr>
    </table>
    ` : ''}

    <h2 class="section-title">ANALISI ECONOMICA</h2>
    <table>
        <tr>
            <th>Voce</th>
            <th>Importo</th>
        </tr>
        <tr>
            <td>Moduli Fotovoltaici e Inverter</td>
            <td>€ ${costoPannelli.toLocaleString('it-IT', {minimumFractionDigits: 2})}</td>
        </tr>
        ${numBatterie > 0 && !isCampoVenditaPDF ? `
        <tr>
            <td>Sistema di Accumulo</td>
            <td>€ ${costoBatterie.toLocaleString('it-IT', {minimumFractionDigits: 2})}</td>
        </tr>
        ` : ''}
        ${tabellaTrasferta}
        <tr style="background: #f5f5f5; font-weight: 700;">
            <td>INVESTIMENTO TOTALE</td>
            <td>€ ${costoTotale.toLocaleString('it-IT', {minimumFractionDigits: 2})}</td>
        </tr>
        <tr>
            <td>${isCampoVenditaPDF ? 'Ricavo Annuale Stimato (Vendita Energia)' : 'Risparmio Energetico Annuo'}</td>
            <td>€ ${ricavoAnnuale.toLocaleString('it-IT', {minimumFractionDigits: 2})}</td>
        </tr>
        <tr style="background: #f8fffe; font-weight: 700; color: #0a5f5f;">
            <td>PERIODO DI AMMORTAMENTO</td>
            <td>${ammortamento.toFixed(1)} anni</td>
        </tr>
    </table>

    ${sezionePagamenti}

    <div class="info-box" style="margin-top: 30px;">
        <strong>NOTE IMPORTANTI:</strong><br>
        • <strong>Prezzo comprensivo di installazione chiavi in mano</strong><br>
        • <strong>I prezzi indicati sono IVA inclusa</strong><br>
        ${percentualeSurplus > 0 ? `• <strong>Include surplus trasferta del ${percentualeSurplus}% per la regione ${regione}</strong><br>` : ''}
        ${isCampoVenditaPDF ? `• <strong>Impianto per vendita energia: il ricavo annuale è calcolato sulla produzione totale venduta alla rete</strong><br>` : ''}
        • Include: moduli, inverter, strutture di montaggio${installazioneCampo === "si" ? ' (struttura per campo con angolazione ottimale)' : ''}, cablaggio, quadri elettrici${numBatterie > 0 && !isCampoVenditaPDF ? ', sistema di accumulo' : ''}<br>
        • Include: progettazione, installazione completa, collaudo, pratiche GSE e connessione alla rete<br>
        ${installazioneCampo === "si" ? '• <strong>Installazione su campo: la struttura sarà progettata con angolazione ottimale per massimizzare la produzione e il ricavo</strong><br>' : ''}
        ${isCampoVenditaPDF ? '• <strong>Per impianti di vendita energia: necessarie ulteriori pratiche burocratiche per accesso agli incentivi statali (tariffa incentivante)</strong><br>' : ''}
        • Garanzia: 25 anni sui moduli, 10 anni sull'inverter${numBatterie > 0 && !isCampoVenditaPDF ? ', 10 anni sulle batterie' : ''}<br>
        • Possibilità di accesso agli incentivi fiscali vigenti<br>
        • Preventivo valido 30 giorni dalla data di emissione
    </div>

    <h2 class="section-title" style="margin-top: 50px;">ACCETTAZIONE PREVENTIVO</h2>
    
    <div class="info-box" style="background: #fff8e1; border-left: 4px solid #f57c00;">
        <strong style="color: #f57c00;">ISTRUZIONI:</strong><br>
        Compilare i seguenti dati, firmare il preventivo e inviarlo via email a <strong>info@bertuzzienergy.it</strong><br>
        Entro <strong>una settimana lavorativa</strong> riceverete il progetto dettagliato dell'abitazione con l'impianto fotovoltaico.<br>
        Successivamente concorderemo insieme l'inizio dei lavori.
    </div>

    <table style="margin-top: 25px;">
        <tr>
            <td style="width: 50%; padding: 20px; border: 2px solid #e0e0e0;">
                <strong style="color: #0a5f5f;">DATI CLIENTE</strong><br><br>
                Nome e Cognome: _________________________________<br><br>
                Indirizzo: _________________________________________<br><br>
                CAP e Città: ______________________________________<br><br>
                Telefono: __________________________________________<br><br>
                Email: _____________________________________________
            </td>
            <td style="width: 50%; padding: 20px; border: 2px solid #e0e0e0; border-left: none;">
                <strong style="color: #0a5f5f;">FIRMA PER ACCETTAZIONE</strong><br><br>
                <div style="height: 120px; border-bottom: 2px solid #333; margin-top: 80px;"></div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                    Data ____/____/________ Firma del Cliente
                </div>
            </td>
        </tr>
    </table>

    <div style="margin-top: 20px; padding: 15px; background: #f0f9f4; border: 2px solid #0a5f5f; border-radius: 8px; text-align: center;">
        <strong style="color: #0a5f5f; font-size: 16px;">
            ✉ Inviare questo preventivo compilato e firmato a: info@bertuzzienergy.it
        </strong>
    </div>

    <div class="footer">
        <strong>BERTUZZI ENERGY S.R.L.</strong><br>
        Sede Operativa: Via Calamelli 14, 40026 Imola (BO)<br>
        Sede Legale: Via Molino Rosso 9/C, 40026 Imola (BO)<br>
        P.IVA/C.F./Registro Imprese: 03111391201<br>
        Email: info@bertuzzienergy.it<br>
        <br>
        <em>Preventivo definitivo soggetto a conferma dopo sopralluogo tecnico.</em>
    </div>
</body>
</html>
    `;

    const preventivoWindow = window.open('', '_blank');
    preventivoWindow.document.write(preventivoHTML);
    preventivoWindow.document.close();
}
</script>
</body>
</html>
